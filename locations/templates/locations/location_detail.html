{% extends 'locations/index.html' %}
{% load i18n %}

{% block content %}
<!-- Main content -->
<div class="col-sm-9">
    <h1>{{ location.name }} {% trans "summary" %}</h1>
    <div>{{ location.description | safe }}</div>
    
    <h2>{% trans "Latest related actions" %}</h2>
    <ul class="last-related-actions">
    {% for action in actions %}
        <li>
            <a href="{% url 'user:profile' action.actor %}">{{ action.actor.get_full_name }}</a> {{ action.verb }}
            {% if action.action_object_content_type %}
                &nbsp;{{ action.action_object_content_type }}&nbsp;
            {% endif %}
            {% if action.action_object.get_absolute_url and action.action_object %}
                <a href="{{ action.action_object.get_absolute_url }}">{{ action.action_object }}</a>
            {% endif %}
            {% if not action.action_object_content_type %}
                <a href="{% url 'locations:details' location.slug %}">{{ location.name | capfirst }}</a>
            {% endif %}
        </li>
    {% endfor %}
    </ul>
</div>
<!-- Sidebar -->
<div class="col-sm-3">
    <ul class="sidebar-right">
    <h3 class="actions-label">{% trans "Actions" %}:</h3>
    <ul class="custom-sidebar-nav">
        {% if user.is_authenticated %}                
        <li>
            {% comment %}
                Link, który pozwala wysłać maila z zaproszeniem do tej lokalizacji.
            {% endcomment %}
            <a href="#" title="{% trans "Invite other users to follow this location" %}" class="invite-toggle">
                <span class="fa fa-plus-circle"> </span> {% trans "Invite users" %}
            </a>
        </li>
        {% endif %}
    </ul>
</div>
<!-- Modal window -->
<div id="modal" class="modal fade"></div>
{% endblock %}

{% block footer_scripts %}
<script>
(function ($) {
    
"use strict";
//
// Handle 'Invite User' system.
// -------------------------------------------------------------------------
var $modal = $('#modal'),
    apiUrl = '{% url 'locations:invite' location.pk %}';

$modal.modal({show:false});

$.get(apiUrl, function (data) {
    $modal.html(data)
        .find('.submit-btn')
        .bind('click', function (evt) {
            evt.preventDefault();
            sendAjaxRequest('POST', apiUrl, {
                data: {
                    'user': $('#id_user').val(),
                    'location': $('#id_location').val()
                },
                success: function (resp) {
                    display_alert(resp.message, resp.level);
                    $modal.modal('hide');
                },
                error: function (err) {
                    console.log(err);
                }
            });
            console.log($('#id_user').val());
            console.log($('#id_location').val());
        });
});

$('.invite-toggle')
    .tooltip()
    .bind('click',
        function (evt) {
            evt.preventDefault();
            $modal.modal('show');
        }
    );
    
})(jQuery);
</script>
{% endblock %}