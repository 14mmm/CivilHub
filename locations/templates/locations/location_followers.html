{% extends 'locations/index.html' %}
{% load staticfiles %}{% load i18n %}
{% block content %}

<div class="col-sm-9">
<div class="main-content">
    
{% comment %}
    List of most active followers.
{% endcomment %}
<h2>{% trans "Most active users" %}</h2>
<ul>
{% for follower in top_followers %}
    <li><a href="{{ follower.user.get_absolute_url }}">{{ follower.user.get_full_name }}</a> - {{ follower.count }}</li>
{% endfor %}
</ul>
    
<div class="followers-entry">
{% for usr in location.users.all %}
    <div class="row">
        <div class="col-sm-3 ">
            <div class="follower">
                <a href="{% url 'user:profile' usr.username %}">
                <div class="follower-photo"><img alt="{{ usr.username }}" src="{{ usr.profile.avatar.url }}">
                </div></a>
                <div class="follower-header">
                    <p class="follower-name">
                        {{ usr.get_full_name }}
                    </p>
                    <div class="points">
                        <span class="points-count">{{ usr.profile.rank_pts }}</span> pkt
                    </div>
                </div>

                <p class="follows-count">
                    Obserwuje: <span>{{ usr.location_set.count }}</span>
                </p>
                <ul class="follows-places">
                    {% for l in usr.location_set.all %}
                        <li><a href="{{ l.get_absolute_url }}">{{ l.name }}</a></li>
                    {% endfor %}
                </ul>
                {% if is_moderator and user != usr %}
                <p class="admin-extra-options">
                    <a href="#" class="moderator-badge-add" data-target="{{ usr.pk }}">{% trans "Give badge" %}</a>
                </p>
                {% endif %}
            </div>
        </div>
    </div>


{% endfor %}

</div>
</div>
</div>

{% if is_moderator %}
{% comment %}
    Wszystkie style są oczywiście do przeniesienia w odpowienie miejsca. Czekam
    na dołączenie deweloperskich plików less do repozytorium.
    Warning: Klasa .submit-btn jest ważna!!!
{% endcomment %}
<style>
.badge-entry { border: 1px solid transparent; }
.badge-selected { border: 1px solid red; }
</style>
<!-- Modal form to choose badge for user. -->
<div id="select-badge-form" class="modal fade">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title">{% trans "Select badge for user" %}</h4>
            </div>
            <div class="modal-body"></div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">{% trans "Close" %}</button>
                <button type="button" class="btn btn-primary submit-btn">{% trans "Select" %}</button>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div><!-- /.modal -->

<script type="text/tamplate" id="badge-tpl">
<div class="col-sm-2">
    <img src="<%= thumbnail %>" alt="<%= name %>" />
</div>
<p class="col-sm-10"><b><%= name %></b><br /><%= description %></p>
</script>
{% comment %}
<script src="{% static 'userspace/js/badges.js' %}"></script>
<script>
(function ($) {
    "use strict";
    //
    // Show only five first locations in follower entry and give users link
    // to hide/show rest of them.
    // -------------------------------------------------------------------------
    //
    $('.follows-places').each(function () {
        // If list is too short, simply return.
        if ($(this).find('li').length <= 5) {
            return true;
        }
        // Prepare DOM elements.
        var $entry  = $(this),
            $links  = $entry.children('li'),
            $toggle = $(document.createElement('a')),
            $hide   = $(document.createElement('a')),
            hidden  = [];
        // For each item, hide it if necessary.
        $links.each(function (idx, el) {
            if (idx > 4) {
                $(el).hide();
                hidden.push($(el));
            }
        });
        // Show hidden links.
        $toggle.appendTo($entry)
            .text('{% trans "Show more" %}')
            .attr('href', '#')
            .on('click', function (evt) {
                evt.preventDefault();
                $(hidden).each(function () {
                    $(this).show('fast');
                });
                $toggle.fadeOut('fast');
                $hide.fadeIn('fast');
            });
        // Hide hidden links.
        $hide.appendTo($entry)
            .hide()
            .text('{% trans "Hide" %}')
            .attr('href', '#')
            .on('click', function (evt) {
                evt.preventDefault();
                $(hidden).each(function () {
                    $(this).hide('fast');
                });
                $hide.fadeOut('fast');
                $toggle.fadeIn('fast');
            });
    });
})(jQuery);
</script>
{% endcomment %}
{% endif %}

{% endblock %}