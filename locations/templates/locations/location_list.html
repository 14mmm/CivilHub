{% extends 'places_core/base.html' %}
{% load staticfiles %}{% load i18n %}

{% block extra_styles %}
<style>
ul.list-column {
    position: absolute;
    z-index: 5000;
    opacity: 0.7;
    background-color: #000000;
    margin: 0px;
    padding-left: 20px;
}
ul.list-column li {
    display: block;
    width: 100%;
    margin: 0px;
    padding: 0px;
}
ul.list-column .close-col {
    position: absolute;
    left: 5px;
    top: 2px;
}
ul.list-column .col-description {
    display: inline-block;
}
ul.list-column .col-controls {
    display: inline-block;
    float: right;
    margin-left: 10px;
}
</style>
{% endblock %}

{% block require_scripts %}

    <script>
    require.config({
        baseUrl: "{% static 'places_core' %}",
        
        urlArgs: "bust=" + (new Date()).getTime(),
        
        waitSeconds: 200,
        
        paths: {
            jquery: 'includes/jquery/jquery',
            bootstrap: 'includes/bootstrap/bootstrap',
            underscore: 'includes/underscore/underscore',
            backbone: 'includes/backbone/backbone',
            ui: 'js/ui/ui',
            utils: 'js/utils/utils',
            common: 'js/common',
            vector: 'includes/vectormap/jquery-jvectormap-1.2.2.min',
            worldmap: 'includes/vectormap/jquery-jvectormap-world-mill-en'
        },
        
        shim: {
            underscore: {
                deps: ['jquery'],
                exports: '_'
            },
            
            backbone: {
                deps: ['underscore'],
                exports: 'Backbone'
            },
            
            bootstrap: {
                deps: ['jquery']
            },
            
            vector: {
                deps: ['jquery']
            },
            
            worldmap: {
                deps: ['vector']
            }
        }
    });

    require(['jquery',
             'js/locations/location-list/col-view',
             'vector',
             'worldmap',
             'common'], 

    function ($, ColView) {
        
        $('#vector-map').vectorMap({
            
            map: 'world_mill_en', 
            
            backgroundColor: 'transparent',
            
            onRegionClick: function (event, code) {
                // Jeżeli jest już aktywna lista dla jakiegoś kraju, nie otwieraj
                // nowego okna.
                if (window.activeSublist !== undefined && window.activeSublist) {
                    return false;
                }
                // Ustalamy pozycję pierwszej listy w lewym górnym rogu mapy.
                var pos = {
                    left: event.target.offsetLeft,
                    top: event.target.offsetTop
                };
                // Sprawdzamy, czy kraj jest już w bazie. Jeżeli tak, otwieramy listę.
                $.get('/api-geo/countries/?code=' + code, function (resp) {
                    if (resp.length) {
                        // Bezwzględnie koniecznie jako pierwszy argument podajemy
                        // pustą tabelę - Backbone zawsze traktuje pierwszy argument
                        // jako kolekcję, co tutaj prowadzi do błędów.
                        var locationList = new ColView([], resp[0].location, pos);
                        window.activeSublist = true;
                    } else {
                        // TODO: coś tu trzeba pokazać.
                        alert("There is no such place");
                    }
                });
            },
            
            regionStyle: {
                initial: {
                    fill: '#8D8D8D',
                    "fill-opacity": 1,
                    stroke: 'none',
                    "stroke-width": 0,
                    "stroke-opacity": 1
                },
                hover: {
                    fill: '#0082FC',
                    "fill-opacity": 0.8
                }
            }

        });
        
        $(document).trigger('load');
        
    });
    </script>
    
{% endblock %}

{% block header %}{% endblock %}

{% block content %}


<script type="text/template" id="list-col-tpl">
    <a href="#" class="close-col"><span class="fa fa-times-circle-o">&nbsp;</span></a>
</script>

<script type="text/template" id="location-entry-tpl">
    <span class="col-description"><a href="/<%= slug %>"><%= name %></a></span>
    <span class="col-controls">
        <% if (followed) { %>
            <a href="#" title="{% trans "Stop following" %}" class="custom-tooltip"><span class="unfollow-entry fa fa-eye-slash" data-target="<%= id %>">&nbsp;</span></a>
        <% } else { %>
            <a href="#" title="{% trans "Follow" %}" class="custom-tooltip"><span class="follow-entry fa fa-eye" data-target="<%= id %>">&nbsp;</span></a>
        <% } %>
        <a href="#" title="{% trans "Expand" %}" class="custom-tooltip"><span class="expand-entry fa fa-play" data-target="<%= id %>">&nbsp;</span></a>
    </span>
</script>


<div class="location-list-page">
    <h1 class="text-center">{% trans "Choose a country, which you love" %}</h1>
        <div id="vector-map"></div>

        <h2 class="text-center">{% trans "If you don't like maps, choose from list" %}</h2>
        {% if locations %}
        <div class="row location-list-stream">
            <div class="col-lg-2"></div>
            
            <div class="col-lg-8 main-content location-list-stream">
                {% comment %}
                    {% for location in locations %}

                        <div class="col-lg-4">
                            <a href="{{ location.get_absolute_url }}">
                            <span class="country-entry"> {{ location.name }} </span></a>
                        </div>
                        
                    {% endfor %}
                {% endcomment %}
                
                {% comment %} WTF ??? 1990 się skończył. {% endcomment %}
                <div class="col-lg-4 country-entry">
                    <a href="/polska">
                        <span>
                        <img src="{% static 'places_core/img/flags/Poland-Flag-48.png' %}" />Polska
                        </span>
                    </a>
                </div>  
                
                <div class="col-lg-4 country-entry">
                    <a href="/united-states">
                        <span>
                        <img src="{% static 'places_core/img/flags/United-States-Flag-48.png' %}" />United States
                        </span>
                    </a>
                </div>  
                
                <div class="col-lg-4 country-entry">
                    <a href="/finland">
                        <span>
                        <img src="{% static 'places_core/img/flags/Finland-Flag-48.png' %}" />Finland
                        </span>
                    </a>
                </div>  
                
                <div class="col-lg-4 country-entry">
                    <a href="/portugal">
                        <span>
                        <img src="{% static 'places_core/img/flags/Portugal-Flag-48.png' %}" />Portugal
                        </span>
                    </a>
                </div>  
                
                <div class="col-lg-4 country-entry">
                    <a href="/germany">
                        <span>
                        <img src="{% static 'places_core/img/flags/Germany-Flag-48.png' %}" />Germany
                        </span>
                    </a>
                </div>  
                
                <div class="col-lg-4 country-entry">
                    <a href="/france">
                        <span>
                        <img src="{% static 'places_core/img/flags/France-Flag-48.png' %}" />France
                        </span>
                    </a>
                </div>  
                
                <div class="col-lg-4 country-entry">
                    <a href="/united-kingdom">
                        <span>
                        <img src="{% static 'places_core/img/flags/United-Kingdom-flag-48.png' %}" />United Kingdom
                        </span>
                    </a>
                </div>  
                 
                <div class="col-lg-4 country-entry">
                    <a href="/">
                        <span>
                        <img src="{% static 'places_core/img/flags/-Flag-48.png' %}" />
                        </span>
                    </a>
                </div>
            </div>
        </div>
        {% endif %}

</div>

{% endblock %}