{% extends 'locations/index.html' %}
{% load staticfiles %}
{% load bookmarks_tags %}{% load i18n %}

{% block content %}
<div class="col-sm-9">
<div class="main-content">
<h1>{{ title }}&nbsp;<span class="fa fa-cog submenu-toggle"> </span></h1>
<div class="entry-submenu">
    <ul>
        {% if marker_form %}<li><p><a href="#" class="map-marker-toggle">{% trans "Add map marker" %}</a></p></li>{% endif %}
        <li>{% bookmark_form for discussion %}</li>
    </ul>
</div>
<hr />

{% if map_markers %}{% include 'maps/minimap.html' %}{% endif %}

{{ discussion.intro | safe }}

{% for entry in replies %}
    <div class="reply-entry well">
        <div class="row">
            <div class="col-xs-1 entry-avatar-col entry-avatar-nomg">
                <img src="{{ entry.creator.profile.avatar.url }}" alt="{{ entry.creator }}" class="news-user-avatar" style="margin-top:0px!important" />
            </div>
            <div class="col-xs-11">
                <p class="entry-meta">
                    <a href="{% url 'user:profile' entry.creator %}">{{ entry.creator.get_full_name }}</a> 
                    <span class="topic-date-col">
                        {{ entry.date_created | timesince }}
                        {% if entry.is_edited %}
                        <label class="label label-default entry-edited-label">{% trans "Edited" %}</label> {{ entry.date_edited | timesince }}
                        {% endif %}
                    </span>
                    <span class="entry-controls">
                        {% if user == entry.creator or is_moderator %}
                            <a href="{% url 'discussion:entry_update' slug=discussion.slug pk=entry.pk %}" title="{% trans "Edit entry" %}">
                                <span class="fa fa-edit"> </span>
                            </a>
                        {% else %}
                            <a href="{% url 'reports:report' app_label='topics' model_label='entry' object_pk=entry.pk %}" title="{% trans "Report abuse" %}" class="report-abuse-link">
                                <span class="fa fa-exclamation-triangle"> </span>
                            </a>
                            <a href="#" title="{% trans "Quote" %}" class="quote-reply-link">
                                <span class="fa fa-reply-all"> </span>
                            </a>
                        {% endif %}
                    </span>
                </p>
                <div class="entry-content">{{ entry.content | safe }}</div>
            </div>
        </div>
    </div>
{% endfor %}
<div class="pagination">
    <span class="step-links">
        {% if replies.has_previous %}
            <a href="?page={{ replies.previous_page_number }}">{% trans "previous" %}</a>
        {% endif %}

        <span class="current">
            {% trans "Page" %} {{ replies.number }} {% trans "of" %} {{ replies.paginator.num_pages }}.
        </span>

        {% if replies.has_next %}
            <a href="?page={{ replies.next_page_number }}">{% trans "next" %}</a>
        {% endif %}
    </span>
</div>
{% if user.is_authenticated and discussion.status %}
<div>
    <button type="button" class="btn btn-primary reply-entry-btn">{% trans "Reply" %}</button>
</div>
<form id="reply-form" role="form" action="{% url 'discussion:reply' discussion.slug %}" method="post" class="hidden-form">
    {% csrf_token %}
    {{ form }}
    <div class="form-group">
        <button type="submit" class="btn btn-primary submit-btn">{% trans "Submit" %}</button>
    </div>
</form>
{% else %}
    <p class="alert alert-info">{% trans "This topic is closed. You can't post answers." %}</p>
{% endif %}
</div>
</div>
{% endblock %}

{% block footer_scripts %}
{% if marker_form %}{% include 'maps/pointer-modal-form.html' %}{% endif %}
{% if user.is_authenticated and discussion.status %}
<script src="{% static 'places_core/includes/ckeditor/ckeditor.js' %}"></script>
<script src="{% static 'gallery/js/media-uploader.js' %}"></script>
<script src="{% static 'topics/js/reply-form.js' %}"></script>
{% endif %}
{% endblock %}