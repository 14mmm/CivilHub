{% extends 'places_core/base.html' %}
{% load staticfiles %}{% load i18n %}

{% block content %}
<div id="map"></div>
{% endblock %}

{% block footer_scripts %}
<script>
(function ($) {
    "use strict";
    var markerIconImage = function (ct) {
        var markers = {
            16: '{% static 'maps/icons/marker-idea.png' %}', // Idea
            34: '{% static 'maps/icons/marker-poll.png' %}', // Poll
            38: '{% static 'maps/icons/marker-discussion.png' %}', // Discussion
            19: '{% static 'maps/icons/marker-news.png' %}'  // News
        };
        return markers[ct];
    }
    //
    // Prepare Google Map
    // ------------------
    function createMap(locations, pointers) {

        var m = null, win = null,
            markers = [];

        var mapOptions = {
            center: new google.maps.LatLng(0, 0),
            zoom: 2
        };

        var map = new google.maps.Map(document.getElementById("map"),
            mapOptions);
            
        function placeMarker(location) {
            var marker = new google.maps.Marker({
                position: location,
                map: map
            });
            return marker;
        }
        
        function infoWindow(content) {
            var win = new google.maps.InfoWindow({
                content: content
            });
            return win;
        }

        $(locations).each(function () {
            var position = new google.maps.LatLng(this.latitude, this.longitude),
                m = placeMarker(position);
                
            google.maps.event.addListener(m, 'click', function(event) {
                var w = infoWindow("This is Sparta!!!");
                w.open(map, m);
            });
        });

        $(pointers).each(function () {
            var position = new google.maps.LatLng(this.latitude, this.longitude),
                m = placeMarker(position);
            // Set custom icon for each content type    
            m.setIcon(markerIconImage(this.content_type));
            // Set listener for info window i
            google.maps.event.addListener(m, 'click', function(event) {
                var w = infoWindow("This is not Sparta!!!");
                w.open(map, m);
            });
        });
    }
    //
    // Fetch objects from server and create map
    // ----------------------------------------
    $.get('/maps/pointers/', function (resp) {
        resp = JSON.parse(resp);
        if (resp.success) {
            createMap(resp.locations, resp.pointers);
        } else {
            console.log("Failed to load map data");
        }
    });
    
})(jQuery);
</script>
{% endblock %}