{% load staticfiles %} {% load i18n %}

{% include 'places_core/header.html' %}

{% include 'places_core/navigation.html' %}  

{% comment %}
    Główny widok mapy.
{% endcomment %}

{% block require_scripts %}

    <script>
    require.config({
        baseUrl: "{% static 'places_core' %}",
        
        urlArgs: "bust=" + (new Date()).getTime(),
        
        waitSeconds: 200,
        
        paths: {
            jquery: 'includes/jquery/jquery',
            bootstrap: 'includes/bootstrap/bootstrap',
            underscore: 'includes/underscore/underscore',
            backbone: 'includes/backbone/backbone',
            tagsinput: 'includes/jquery/jquery.tagsinput',
            ui: 'js/ui/ui',
            common: 'js/common.js'
        },
        
        shim: {
            underscore: {
                deps: ['jquery'],
                exports: '_'
            },
            
            backbone: {
                deps: ['underscore'],
                exports: 'Backbone'
            },
            
            bootstrap: {
                deps: ['jquery']
            },
            
            tagsinput: {
                deps: ['jquery']
            },
        }
    });

    require(['jquery', 'ui', 'common', 'js/maps/mainMap'], function ($, ui) {
        
        ui.message.success("Main application loaded");
        
        $(document).trigger('load');
        
    });
    </script>
    
{% endblock %}

<div id="map-options-toggle">
    <a id="map-filter-toggle" href="#" title="{% trans "Show options" %}">
        <span class="fa fa-arrow-circle-down"> </span>
    </a>
    <a id="map-follow-toggle" href="#" title="{% trans "Only followed locations" %}">
        <span class="fa fa-circle-o"> </span>
    </a>
</div>
<nav id="map-options-panel" role="navigation">
    <ul>
        <li>Places <input type="checkbox" data-target="location" class="map-filter-toggle" checked="checked" /></li>
        <li>Ideas <input type="checkbox" data-target="idea" class="map-filter-toggle" checked="checked" /></li>
        <li>Polls <input type="checkbox" data-target="poll" class="map-filter-toggle" checked="checked" /></li>
        <li>Discussions <input type="checkbox" data-target="discussion" class="map-filter-toggle" checked="checked" /></li>
        <li>News <input type="checkbox" data-target="news" class="map-filter-toggle" checked="checked" /></li>
    </ul>
</nav>

<div id="map"></div>

<script type="text/template" id="user-popup-tpl">
    <div class="user-popup-avatar">
        <img src="<%= avatar %>" alt="<%= username %>" />
    </div>
    <div class="user-popup-details">
        <span class="fa fa-times-circle-o user-popup-close"> </span>
        <p class="user-popup-personals">
            <a href="<%= user_link %>"><%= fullname %></a><br />
            <%= rank_pts %> {% trans 'pts' %}
        </p>
        <p>
            <% for (var i = 0; i < follows.length; i++) { %>
                <%= follows[i] %>,&nbsp;
            <% } %>
        </p>
    </div>
</script>

</body>
</html>