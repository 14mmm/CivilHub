{% extends 'locations/index.html' %}
{% load staticfiles %}
{% load civil_tags %}
{% load i18n %}

{% block title %} {{ idea.name }}, {{ location.name }} | CivilHub {% endblock %}

{% block meta %} 
<meta property="og:title" content="{{ idea.name }}, {{ location.name }}"/>
<meta property="og:image" content="{{ idea.creator.profile.avatar.url }}"/>
<meta property="og:site_name" content="CivilHub"/>
<meta property="og:description" content="{{ idea.description|striptags|slice:":100" }}..." />
<meta name="keywords" content="{{ idea.name }}, {{ idea.location }}, {% for tag in idea.tags.all %}{{ tag.name }}, {% endfor %}">
{% endblock %}

{% block require_scripts %}
{% include 'maps/minimap.html' %}
<script>window.commentListSize = {% page_size %};</script>
<script data-main="{% static 'places_core' %}/js/build/ideas/detail/idea-detail-built.js" src="{% static 'places_core' %}/includes/require/require.js"></script>
{% endblock %}

{% block content %}

<div class="main-content col-sm-8">
    {% include 'maps/pointer-modal-form.html' %}
    <div class="row idea-entry">
        <div class="idea-votes col-sm-3">
            <div class="vote-form">
                <div class="votes" data-target-id="{{ idea.pk }}">{{ idea.get_votes }}</div>
                <div class="vote-controls">
                    {% if user.is_authenticated %}
                    <button data-target-id="{{ idea.pk }}" data-vote="up" class="vote-btn" data-toggle="tooltip" data-placement="top" title="{% trans "Good Idea, Vote YES" %}"  rel='tooltip'><span class="fa fa-angle-up"></span></button>
                    <button data-target-id="{{ idea.pk }}" data-vote="down" class="vote-btn" data-toggle="tooltip" data-placement="bottom" title="{% trans "Bad Idea, Vote NO" %}"  rel='tooltip'> <span class="fa fa-angle-down"></span></button>
                    {% else %}
                        <!-- Dodanie parametrow GET aby powrocic do strony ideas -->
                        <form action="{% url 'user:login' %}" method="GET">
                            <input type="hidden" name="url" value="{{ request.path }}" />
                            <button class="vote-btn" type="submit" title="{% trans "Good Idea, Vote YES" %}"><span class="fa fa-angle-up"></span></button>
                            <button class="vote-btn" type="submit" title="{% trans "Bad Idea, Vote NO" %}" %}"><span class="fa fa-angle-down"></span></button>
                        </form>
                    {% endif %}
                </div>
            </div>

            <div class="clear">&nbsp;</div>
            <div class="idea-summary">
                <div class="idea-status-state">
                    {% if idea.status %}
                    <label class="label label-success">{% trans "Active" %}</label>
                    {% else %}
                    <label class="label label-danger">{% trans "Inactive" %}</label>
                    {% endif %}
                </div>
                <div class="idea-vote-count" data-target="{{ idea.pk }}">{{ idea.vote_set.all.count }} {% trans "votes" %}</div>
            </div>
            {% if map_markers %}<div id="minimap"></div>{% endif %}
            {% if idea.creator == user or is_moderator %}

            <p><a href="#" class="map-marker-toggle">{% trans "Add map marker" %}</a></p>
            {% endif %}

            {% include 'locations/share_buttons.html' %}            
            
        </div>
        <div class="col-sm-9">

            <h1>{{ idea.name }}&nbsp;<span class="submenu-toggle"> </span></h1>
                <div class="entry-submenu">
                    <ul>
                        <li><a href="#" class="map-marker-toggle">{% trans "Add map marker" %}</a></li>
                        {% if user.is_superuser or user == idea.creator or is_moderator %}
                        <li><a href="{% url 'ideas:update' idea.slug %}">{% trans "Edit" %}</a></li>
                        {% endif %}
                        <li>{% bookmark_form idea user %}</li>
                        <li><a class="report-abuse-link" href="{% url 'reports:report' app_label='ideas' model_label='idea' object_pk=idea.pk %}">{% trans "Report abuse" %}</a></li>
                    </ul>
                </div>
                <div class="author-info">
                    <small>
                        <img src="{{ idea.creator.profile.avatar.url }}" alt="{{ idea.creator.get_full_name }}" class="user-avatar mini user-window-toggle" data-target="{{ idea.creator.pk }}" />     
                        <a href="{% url 'user:profile' idea.creator %}" class="user-window-toggle" data-target="{{ idea.creator.pk }}">{{ idea.creator.get_full_name }}</a> {{ idea.date_created }}
                    </small>
                </div>
                <div class="acticle-content">{{ idea.description | safe }}</div>
    <p>{% trans "Tags" %}:
        {% for tag in idea.tags.all %}
        <a class="tag" href="{% url 'locations:tag_search' slug=idea.location.slug tag=tag.name %}" />{{ tag }}</a>  
        {% endfor %}
    </p>
    <p>
        {% if idea.category %}
                <span class="fa fa-star"> </span>{% trans "Category" %}:
                    <a href="{% url 'locations:category_search' slug=idea.location.slug app='ideas' model='idea' category=idea.category.pk %}">{{ idea.category }}</a>
        {% endif %}
    </p>
        <div>
            <p>
                {% trans "Comments" %}: <span class="badge comment-count">{{ idea.comments }}</span>
                <a class="comment-toggle" data-target="{{ idea.pk }}" href="#">{% trans "Hide comments" %}</a>
            </p>
        </div>
        
        <input type="hidden" id="target-id" value="{{ idea.pk }}" />
        <input type="hidden" id="target-label" value="ideas" />
        <input type="hidden" id="target-type" value="{{ idea.content_type }}" />
        <input type="hidden" id="target-user" value="{{ user.username }}" />
        <input type="hidden" id="target-avatar" value="{{ user.profile.avatar.url }}" />
        <input type="hidden" id="target-user-fullname" value="{{ user.get_full_name }}" />
        
        {% include 'comments/commentlist.html' %}
        
    </div>

</div>
</div>

    {% include 'ideas/idea-votes.html' %}

    {% include 'locations/category-form.html' %}

    <div class="col-sm-4">
        {% include 'locations/sidebar.html' %}
    </div>

{% endblock %}