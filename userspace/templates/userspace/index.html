{% extends 'places_core/base.html' %}
{% load staticfiles %}{% load i18n %}

{% block require_scripts %}
<script data-main="{% static 'places_core' %}/js/build/userspace/form/userspace-form-main.js" src="{% static 'places_core' %}/includes/require/require.js"></script>
{% endblock %}

{% block content %}

{% for error in errors %}
    {{ error }}
{% endfor %}
{% if user.is_authenticated %}

<div class="row">
    <div class="col-sm-3">
        <div class=" sidebar">
            <div class="sidebar-content">
                <img src="{{ profile.avatar.url }}" alt="Avatar" class="user-thumb" />
                <form id="upload-avatar-form" role="form" enctype="multipart/form-data" method="post" action="{% url 'user:upload_avatar' %}">
                    {% csrf_token %}
                    {{ avatar_form }}
                </form>
                {% comment %}<p><button class="btn btn-primary avatar-toggle-btn">{% trans "Change avatar" %}</button></p>{% endcomment %}
                {% comment %}<p><a href="{% url 'user:chpass' %}">{% trans "Change password" %}</a></p>{% endcomment %}
                <ul>
                    <li><a href="#" class="simple-tabs-link" data-target="tab-1">{% trans "Profile summary" %}</a></li>
                    <li><a href="#" class="simple-tabs-link" data-target="tab-2">{% trans "Change password" %}</a></li>
                </ul>
                <p>{% trans "Points" %}: {{ profile.rank_pts }}</p>
                <ul>
                {% for badge in profile.badges.all %}
                    <li><img src="{{ badge.thumbnail.url }}" alt="{{ badge.name }}" class="user-badge-thumb" title="{{ badge.name}} - {{ badge.description | escape }}" /></li>
                {% endfor %}
                </ul>
            </div>
        </div>
    </div>
    <div class="col-sm-9">
        <div class="main-content">
            <div class="simple-tabs" id="user-profile-tabs">
                <div class="simple-tabs-tab active" id="tab-1">
                    <form id="user-profile-form" class="form-horizontal" method="post" action="{% url 'user:save_settings' %}">
                        {% csrf_token %}
                        {{ form.as_p }}
                        <button type="submit" class="btn btn-primary">{% trans "Save changes" %}</button>
                    </form>
                </div>
                <div class="simple-tabs-tab" id="tab-2">
                    <form id="user-password-form" class="form-horizontal" method="post" action="{% url 'user:chpass' %}">
                        {% csrf_token %}
                        {{ passform.as_p }}
                        <button type="submit" class="btn btn-primary">{% trans "Save changes" %}</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script type="text/template" id="avatar-form-tpl">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title">{% trans "Choose Avatar" %}</h4>
            </div>
            <div class="modal-body">
                <img id="avatar-img-placeholder" style="display:none;max-width:100%" />
                <form id="modal-upload-form" enctype="multipart/form-data" action="{% url 'user:upload_avatar' %}" method="post">
                    {% csrf_token %}
                    {{ avatar_form }}
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">{% trans "Cancel" %}</button>
                <button type="button" class="btn btn-primary submit-btn">{% trans "Send" %}</button>
            </div>
        </div>
    </div>
</script>

{% include 'gallery/media-uploader.html' %}

{% else %}
    <p class="custom-booklike">{% trans "You are not allowed to visit this page. Sorry." %}</p>
{% endif %}
{% endblock %}
