{% extends 'places_core/base.html' %}
{% load staticfiles %}{% load i18n %}

{% block require_scripts %}

    <script>
    require.config({
        baseUrl: "{% static 'places_core' %}",
        
        urlArgs: "bust=" + (new Date()).getTime(),
        
        waitSeconds: 300,
        
        paths: {
            jquery: 'includes/jquery/jquery',
            bootstrap: 'includes/bootstrap/bootstrap',
            underscore: 'includes/underscore/underscore',
            backbone: 'includes/backbone/backbone',
            common: 'js/common',
            ckeditor: 'includes/ckeditor/ckeditor',
            dropzone: 'includes/dropzone/dropzone',
            jqueryui: 'includes/jquery-ui/jquery-ui'
        },
        
        shim: {
            underscore: {
                deps: ['jquery'],
                exports: '_'
            },
            
            backbone: {
                deps: ['underscore'],
                exports: 'Backbone'
            },
            
            bootstrap: {
                deps: ['jquery']
            },
            
            ckeditor: {
                exports: 'CKEDITOR'
            },
            
            jqueryui: {
                deps: ['jquery']
            },
            
            dropzone: {
                deps: ['jquery'],
                exports: 'Dropzone'
            }
        }
    });

    require(['jquery',
             'js/userspace/profile/avatarForm',
             'js/userspace/profile/profileForm',
             'common'],

    function ($, DiscussionForm) {
        
        $(document).trigger('load');
        
    });
    </script>

{% endblock %}

{% block content %}
{% for error in errors %}
    {{ error }}
{% endfor %}
{% if user.is_authenticated %}

<div class="row">
    <div class="col-sm-3">
        <img src="{{ profile.avatar.url }}" alt="Avatar" class="user-thumb" />
        <form id="upload-avatar-form" role="form" enctype="multipart/form-data" method="post" action="{% url 'user:upload_avatar' %}">
            {% csrf_token %}
            {{ avatar_form }}
        </form>
        <p><a href="{% url 'user:chpass' %}">{% trans "Change password" %}</a></p>
        <p>Points: {{ profile.rank_pts }}</p>
        <ul>
        {% for badge in profile.badges.all %}
            <li><img src="{{ badge.thumbnail.url }}" alt="{{ badge.name }}" class="user-badge-thumb" title="{{ badge.name}} - {{ badge.description | escape }}" /></li>
        {% endfor %}
        </ul>
    </div>
    <div class="col-sm-9">
        <form id="user-profile-form" method="post" action="{% url 'user:save_settings' %}">
            {% csrf_token %}
            {{ form }}
            <div class="form-group">
                <button type="submit" class="btn btn-primary">{% trans "Save changes" %}</button>
            </div>
        </form>
    </div>
</div>
{% include 'gallery/media-uploader.html' %}
{% else %}
    <p class="custom-booklike">{% trans "You are not allowed to visit this page. Sorry." %}</p>
{% endif %}
{% endblock %}
