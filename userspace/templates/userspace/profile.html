{% extends 'places_core/base.html' %}
{% load staticfiles %}{% load i18n %} 

{% block header %}

    <div class="location-logo" style="background-image:url({{ profile.background_image.url }})">
        <div class="container">
            
        </div>
    </div>
    <nav id="filter-navbar" class="navbar navbar-default" role="navigation">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-location-collapse-menu">
                  <span class="sr-only">{% trans "Toggle navigation" %}</span>
                  <span class="icon-bar"></span>
                  <span class="icon-bar"></span>
                  <span class="icon-bar"></span>
                </button>
              </div>
            <div class="collapse navbar-collapse" id="bs-location-collapse-menu">
                <ul class="nav navbar-nav navbar-right">
                    <ul class="nav navbar-nav">
                    <li><a href="#" class="list-controller active" data-control="content" data-target="">{% trans "Everything" %}</a></li>
                    <li class="navbar-text"> | {% trans "Past" %}:</li>
                    <li><a href="#" class="list-controller" data-control="content" data-target="idea">{% trans "Ideas" %}</a></li>
                    <li><a href="#" class="list-controller" data-control="content" data-target="news">{% trans "Blog" %}</a></li>
                    <li><a href="#" class="list-controller" data-control="content" data-target="location">{% trans "Locations" %}</a></li>
                    <li><a href="#" class="list-controller" data-control="content" data-target="poll">{% trans "Polls" %}</a></li>
                </ul>
                <form id="haystack-form" class="navbar-form navbar-right" role="search" method="get" action="">
                    <div class="form-group">
                        <input type="text" name="haystack" id="haystack" placeholder="{% trans "Search" %}..." class="form-control" />
                    </div>
                    <button type="submit" class="search-button"><span class="fa fa-search"></span></button>
                </form>
            </div>
        </div>
    </nav>

{% endblock %}

{% block content %}

    <div class="user-activities col-sm-9">
        
        <div class="col-sm-3 user-data">
            <div class="profile-page-avatar">
                <img src="{{ profile.avatar.url }}" alt="{{ cuser.username }}" />
            </div>
            <p class="profile-page-details">
                {{ cuser.get_full_name }}
                <br />
                {{ profile.rank_pts }}
            </p>
            {% if profile.badges %}
                <ul class="user-badges-list">
                {% for badge in profile.badges.all %}
                    <li><img src="{{ badge.thumbnail.url }}" alt="{{ badge.name }}" class="custom-tooltip badge-thumbnail" title="{{ badge.name}} - {{ badge.description | escape }}" /></li>
                {% endfor %}
                </ul>
            {% endif %}
            {% if profile.followed_locations %}
                <ul class="user-following-list">
                {% for location in profile.followed_locations %}
                    <li><a href="{{ location.get_absolute_url }}">{{ location.name }}</a></li>
                {% endfor %}
                </ul>
            {% endif %}
        </div>
        
        <div class="col-sm-9 main-content user-activity-stream">
            
            {% for action in stream %}<noscript>
                <div class="row user-action-entry">
                    
                    <div class="col-xs-2 entry-avatar-col">
                        <img src="{{ action.actor.profile.avatar.url }}" alt="{{ action.actor.username }}" class="inline-user-avatar" />
                        <p>{{ action.actor.profile.rank_pts }}</p>
                    </div>
                    
                    <div class="col-xs-10 entry-meta-col">
                        <div class="entry-header">
                            <a href="{{ action.actor.get_absolute_url }}">{{ action.actor.get_full_name }}</a>
                            {{ action.verb }}
                            {% if action.action_object_content_type %}
                                &nbsp;{{ action.action_object_content_type }}&nbsp;
                            {% endif %}
                            {% if action.action_object %}
                                {% if action.action_object.get_absolute_url %}
                                    <a href="{{ action.action_object.get_absolute_url }}">{{ action.action_object }}</a>
                                {% else %}
                                    <a href="{{ action.target_url }}">{{ action.action_object }}</a>
                                {% endif %}
                            {% endif %}
                            {% if action.action_object and action.target %}to{% endif %}
                            {% if action.target %}
                                {% if action.target.get_absolute_url %}
                                    <a href="{{ action.target.get_absolute_url }}">{{ action.target }}</a>
                                {% else %}
                                    <a href="{{ action.target_url }}">{{ action.target }}</a>
                                {% endif %}
                            {% endif %}
                            {{ action.timestamp|timesince }} {% trans "ago" %}
                        </div>
                        <div class="entry-body">
                            {% if action.action_object_content_type.model == 'poll' %}
                                {{ action.action_object.question | safe | truncatewords_html:25 }}
                            {% endif %}
                            
                            {% if action.action_object_content_type.model == 'idea' %}
                                {{ action.action_object.description | safe | truncatewords_html:25 }}
                            {% endif %}
                            
                            {% if action.action_object_content_type.model == 'news' %}
                                {{ action.action_object.content | safe | truncatewords_html:25 }}
                            {% endif %}
                            
                            {% if action.action_object_content_type.model == 'location' %}
                                {{ action.action_object.description | safe | truncatewords_html:25 }}
                            {% endif %}
                        </div>
                        <div class="clear">&nbsp;</div>
                        <div class="entry-footer">
                            {% trans "Share" %}: <span class="fa fa-facebook">&nbsp;</span><span class="fa fa-twitter">&nbsp;</span>
                        </div>
                    </div><!-- // .entry-meta-col -->
                    
                </div><!-- // .user-action-entry -->
            </noscript>{% endfor %}
            
        </div><!-- // .user-activity-stream -->
        
    </div><!-- // .user-activities -->
    
    <script type="text/template" id="action-template">
        <div class="col-xs-2 entry-avatar-col">
            <img src="<%= actor.avatar %>" alt="<%= actor.username %>" class="inline-user-avatar" />
            <p><%= actor.rank_pts %></p>
        </div>
        
        <div class="col-xs-10 entry-meta-col">
            <div class="entry-header">
                <a href="<%= actor.user_link %>"><%= actor.fullname %></a>
                <%= verb %>
                <% if (!_.isEmpty(object_ct)) { %>
                    <%= object_ct %>
                    <% if (_.isEmpty(target_ct)) { %>
                        <a href="<%= object.url %>"><%= object.name %></a>
                    <% } else { %>
                        <a href="<%= object.url %>"><%= object.name %></a>
                        {% trans "to" %} <a href="<%= target.url %>"><%= target.name %></a>
                    <% } %>
                <% } else if (!_.isEmpty(target_ct)) { %>
                    <a href="<%= target.url %>"><%= target.name %></a>
                <% } %>
            </div>
            <div class="entry-body"><%= description %></div>
            <div class="clear">&nbsp;</div>
            <div class="entry-footer">
                {% trans "Share" %}: <span class="fa fa-facebook">&nbsp;</span><span class="fa fa-twitter">&nbsp;</span>
            </div>
        </div><!-- // .entry-meta-col -->
    </script>
    
    <script>
        app.actionApiUrl = "{% url 'rest:my_actions-list' %}";
        app.actionUserId = {{ cuser.pk }};
    </script>
    
    <script src="{% static 'userspace/js/profile.js' %}"></script>
    
    <script>
    (function ($) {
        "use strict";
        var $list = $('.user-following-list'),
            $items = $list.find('li');
        $list.css({
            'list-style-type': 'none',
            'padding-left': '10px'
        })
        $items.prepend('<span class="fa fa-thumb-tack">&nbsp;</span>');
        $items.not(':first').find('.fa:first').css('opacity', 0);
    })(jQuery);
    </script>

    {% include 'locations/sidebar.html' %}
    
{% endblock %}